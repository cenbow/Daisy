"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.UI=exports.Stats=exports.Message=exports.Dialog=exports.Checkin=void 0;var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_util=require("common/util"),Checkin=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"init",value:function(){var e={config:{target:"#j-checkin-box",closeBtn:"#j-checkin-close",diceImg:"#j-dice-action",signInUrl:"/member/check/"},show:function(){var e=this;$.shade("show"),$(e.config.target).show(),this.diceAnimate(),setTimeout(function(){e.getDiceNumber()},1750),$(this.config.closeBtn+",.u-shade").on("click",function(){e.close(),window.location.reload()})},close:function(){$(this.config.target).hide(),$.shade("hide"),1===$("#j-reputation-checkin").length&&window.location.reload()},diceAnimate:function(){var e=this.config.diceImg,t=0;this.timer=setInterval(function(){t+=1,t>4&&(t=1),$(e).attr("class","u-dice-action u-dice-b"+t)},120)},getDiceNumber:function(){var e=this;$.getJSON(this.config.signInUrl,function(t){if(t.success){clearInterval(e.timer);var i=t.result.gainPopularity,n=t.result.popularityDouble,a=i,o=a,s=$("#j-reputation-checkin");n>1&&(o=i+"x"+n);var r=$(e.config.target).data("isBirthday"),c=$(e.config.diceImg);if(c.prop("class","u-dice-action u-dice-a"+a),$("#j-checkin-btn").remove(),r?$(e.config.target).addClass("z-birthday").find(".j-checkin-point").text(o).parent().fadeIn():($(e.config.target).find(".j-checkin-point").text(o).parent().fadeIn(),n>1&&c.after("<em>x&nbsp<span>"+n+"</span></em>")),1===s.length){s.data("isChecked",!0).addClass("u-myinvite-signInLater").removeClass("u-myinvite-signIn").find("span").html("<i>+</i><em class='f-ff-amount'>"+i+"</em><div class='f-ff-dian'>点</div>").next("i").addClass("f-fs14").removeClass("f-fs16").text("今日签到人气值");var l=$("#j-popularity-value");l.text(Number(l.text())+i)}}else{var u=Number(t.resultCodeEum[0].code);switch(u){case 90050:$.xDialog({content:"您已签到，请勿重复操作。",callback:function(){$.shade("hide"),window.location.reload()}})}}})}};1===$("#j-checkin-box").length&&$("#j-checkin-btn,#j-reputation-checkin").on("click",function(t){if(t.stopPropagation(),"undefined"!=typeof $(this).data("isChecked"))return!1;e.show();var i=$("#j-banner-shade");return i.length&&(i.remove(),$("#j-checkin-guide").remove()),!1})}},{key:"guide",value:function(e){var t=_util.Util.storage("checkinDaily"),i=_util.Util.format(environment.serverDate,"yyyy-MM-dd").replace(/-/g,""),n=$("#j-checkin-guide");if(t&&t===i)return 1===n.length&&n.remove(),!1;var a=$(e);if(0===a.find(".u-shade").length&&1===n.length){a.append("<div class='u-shade u-signin-shade' id='j-banner-shade'></div>");var o=$("#j-banner-shade");n.show().on("click","span",function(){_util.Util.storage("checkinDaily",i),n.remove(),o.remove()}).on("click","button",function(){$(this).data("logined")?(n.remove(),o.remove(),$("#j-checkin-btn").click()):window.location.href="/security/login/"})}}}]),e}(),Dialog=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"showErrorMessage",value:function(e){if(e.resultCodeEum){var t="";for(var i in e.resultCodeEum)t=e.resultCodeEum[i].msg+t;this.show({content:t,type:"error"})}else this.show({content:e.result,type:"error"})}}],[{key:"show",value:function(e){if($(".ui-popup").remove(),"undefined"==typeof e||!$.isPlainObject(e))throw new TypeError("dialog参数类型错误或不存在");var t="";if("undefined"==typeof e.type)t="info";else switch(e.type){case"error":t="error2";break;case"warn":t="warn";break;case"success":t="success2";break;default:t="info"}var i=e.title?e.title:"提示",n=e.content?e.content:"",a=e.okValue?e.okValue:"确定",o=e.cancelValue?e.cancelValue:"取消",s=e.width||360,r=e.height||140,c="function"!=typeof e.callback?function(){}:e.callback,l=function(){},u="";"function"==typeof e.cancel?(l=e.cancel,u="<a href='javascript:void(0)' class='f-round u-btn-white j-dialog-cancel'>"+o+"</a></div>"):l=function(){};var d=function(){};"function"==typeof e.close&&(d=e.close);var f="<div class='u-dialog-wrap'><i class='u-icon-"+t+" u-icon f-icon-37'></i><span>"+n+"</span><div class='u-dialog-btn'><a href='javascript:void(0)' class='f-round u-btn-white j-dialog-ok'>"+a+"</a>"+u+"</div>",h=window.dialog({title:i,content:f,skin:"u-dialog-box",width:s,height:r});h.show(),$(".j-dialog-ok").click(function(){h.close().remove(),c()}),$(".j-dialog-cancel").click(function(){h.close().remove(),l()}),$(".ui-dialog-close").click(function(){d()})}},{key:"showErrorResultMessage",value:function(e){var t="支付失败";if(null!=e.result||""==e.result)t=e.result;else if(null!=e.resultCodeEum&&""!=e.resultCodeEum){var i="";for(var n in e.resultCodeEum)i=e.resultCodeEum[n].msg+i;t=i}this.show({content:t})}}]),e}(),Message=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"pushUnreadMessage",value:function(e){function t(e){if(!i||n)return!1;var t=_util.Util.storage("msgNotice.url"),c=Number(_util.Util.storage("msgNotice.count"));switch(e){case"onload":_util.Util.storage("msgNotice.url",a+":"+o);break;case"onTimer":if(t){if(t!==a+":"+o)return c?($("#j-umsg-number").text(c),s.removeClass("z-hidden")):s.addClass("z-hidden"),!1}else _util.Util.storage("msgNotice.url",a+":"+o)}$.ajax({url:environment.globalPath+"/message/unreadMessage",type:"GET",dataType:"json",success:function(e){e.success&&(e.result>0?($("#j-umsg-number").text(e.result),s.removeClass("z-hidden")):s.addClass("z-hidden"),_util.Util.storage("msgNotice.count",e.result))},error:function(e,t,i){clearInterval(r),_util.Util.storage("msgNotice.url",null)}})}var i=!!$(".m-user-menu").length,n=!!$("#j-umsg-filter").length,a=(new Date).getTime(),o=location.href.replace(environment.globalPath,""),s=$("#j-umsg-notice");t("onload");var r=setInterval(function(){t("onTimer")},1e3*e);setTimeout(function(){r&&clearInterval(r)},1801e3),$(window).unload(function(){var e=_util.Util.storage("msgNotice.url"),t=location.href.replace(environment.globalPath,"");e===t&&_util.Util.storage("msgNotice.url",null)})}}]),e}(),Stats=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerTrace",value:function(){var e=_util.Util.getUrlParam("registerTraceNo"),t=_util.Util.getUrlParam("registerTraceSource"),i=new Date;i.setTime(i.getTime()+18e5),e&&_util.Util.setCookie("registerTraceNo",e,i),t&&_util.Util.setCookie("registerTraceSource",t,i)}}]),e}(),UI=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"shade",value:function e(t){var e=$(".u-shade");if("undefined"==typeof t||"show"===t)if(e.length)e.show();else{var i=$("body"),n=i.height(),a="<div class='u-shade' style='height:"+n+"px'></div>";i.append(a)}else"hide"===t&&e.remove()}}]),e}();exports.Checkin=Checkin,exports.Dialog=Dialog,exports.Message=Message,exports.Stats=Stats,exports.UI=UI;
//# sourceMappingURL=cube.js.map
