"use strict";function loadTransactionInterestData(){var t={url:environment.globalPath+"/transaction/interest/calendar",type:"get",callback:loadTransactionInterestDataCallback};_util.Util.post(t)}function renderProfitCal(t,e){var a=[],n="",i=$(t),o=new Date,r=o.getMonth(),c=o.getFullYear();if("number"!=typeof e)return!1;for(var l=1;l<=e;l++)n+="<td></td>";for(var s=1;s<=31;s++)a.push("<tr>"+n+"</tr>");a=a.join(""),i.find("tbody").append(a),$(".m-profit-cal table").width(104*e),$("#j-profit-cal").scrollLeft(104*(12*(c-2015)-2+r))}function loadTransactionInterestDataCallback(t){if("undefined"!=typeof t&&null!==t.resultList){var e=new Date,a=$("#j-transaction-tab"),n=12*(e.getFullYear()-2015);a.find("tr:eq("+(e.getDate()+1)+") td:eq("+(e.getMonth()+2+n)+")").addClass("z-today"),e=new Date(e.getFullYear(),e.getMonth(),e.getDate()),$.each(t.resultList,function(t,e){var n=e.month,i=e.day,o=e.num,r=e.noNum||0,c=e.overNum||0,l=e.overNoPayNum||0,s=e.preNum||0,u=e.year,p=(e.totalPayablePrincipal,e.totalPayableInterest,n);if(o>0||r>0||c>0||l>0||s>0){var d=(new Date).getFullYear();p=u===d?n+12*(d-2015)+2:n+12*(u-2015)+2;var m=(new Date(e.payDate).getTime(),1);(o>0||s>0||c>0)&&0==r&&0==l&&(m=0);var h=a.find("tr:eq("+(i+1)+") td:eq("+(p-1)+")");h.addClass("j-cal-tips").attr({"data-date":u+"-"+n+"-"+i}).html(getDataPoint(o,m))}}),calTips(),incomeStatisticsDetail()}}function calTips(){var t=$("#j-transaction-tab");t.on("mouseenter",".j-cal-tips",function(){function e(e){var i=e.result,o=n.split("-");if(i.date=n,i.month=o[1],i.day=o[2],"function"!=typeof _template.template)return!1;var r=i.calendarTransactionInterestDetailDto.transactionInterestList||[],c=0,l=0;$.each(r,function(t,e){1!=e.status&&(c+=1),1==e.status&&(l+=1)}),i.calendarTransactionInterestDetailDto.topay=c,i.calendarTransactionInterestDetailDto.paied=l,$("#j-topay").text(c),$("#j-paied").text(l);var s=i.calendarTransactionInterestDetailDto.transactionInterestList||[];i.calendarTransactionInterestDetailDto.transactionInterestList=s;var u=s.length,p=(0,_template.template)("j-cal-tpl",i),d=$("#j-cal-detail");d.html(p);var m=0;u>6&&(u=6,m=22);var h=146+33*u+m;a.popupPosition({target:d,width:620,height:h}),t.on("mouseenter","td",function(){$(this).hasClass("j-cal-tips")||$("#j-cal-detail").hide()})}var a=$(this),n=$(this).data("date"),i=$(this).data("calData");i?e(i):_util.Util.post({url:"/memberBalance/getMemberInterestDetail",data:{date:n},callback:function(t){t.success&&t.result&&(e(t),a.data("calData",t))}})}).on("mouseleave",".j-cal-tips",function(t){})}function incomeStatisticsDetail(){var t=$("#j-income-statistics");t.on("mouseover",".j-popup-profit",function(){function t(t){var i=t;if(i.title=a,i.url=n,i.reqType=o,"function"!=typeof _template.template)return!1;var r=(0,_template.template)("j-transaction-interest-detail-tpl",i),c=$("#j-transaction-interest-detail"),l=145+28*(t.result.length-1);c.html(r),e.popupPosition({target:c,height:l,width:340,offset:15}),e.on("mouseleave",function(){var t=setTimeout(function(){c.hide()},300);c.on("mouseenter",function(){clearTimeout(t)})})}var e=$(this),a=$(this).data("title"),n=$(this).data("url"),i=$(this).data("type"),o=e.parents(".u-statBox").data("type"),r=e.parents(".j-principal-type").data("type"),c=$(this).data("incomeData"),l="";switch(o){case"interest":l="/memberBalance/getTransactionInterestDetailForMember";break;case"principal":l="transPrincipal"===r?"/memberBalance/getTransactionDetailForMember":"hadTransferValue"===i?"/memberBalance/getTransactionInterestDetailForMemberTransfer":"/memberBalance/getTransactionPrincipalDetailForMember";break;case"trPrincipal":l=l="/memberBalance/getTransferDetailForMember"}c?t(c):"trPrincipal"==o?_util.Util.post({url:l,data:{type:i},type:"GET",callback:function(a){a.success&&a.result&&(t(a),e.data("incomeData",a))}}):_util.Util.post({url:l,data:{type:i},callback:function(a){a.success&&a.result&&(t(a),e.data("incomeData",a))}})}).on("mouseleave",".j-popup-profit",function(t){$(".ui-popup").remove()})}function getDataPoint(t,e){var a="●",n="";return e&&(a="○"),n=a,""!==n?"<i>"+n+"</i>":""}function exchangeCouponByTemplateId(t){var e=$("#xToken").attr("value");_util.Util.post({url:environment.globalPath+"/coupon/exchange",data:{couponTemplateId:t,num:1,xToken:e},callback:function(t){if(t.success){var e="查看我的现金券!",a="/coupon/couponList";null!=t.result&&null!=t.result.couponType&&2==t.result.couponType&&(e="查看我的收益券",a="/coupon/profitCouponList"),$("body").find(".u-shade").click(),$(".j-cashCouponSlideBtn-show").hide(),_cube.Dialog.show({content:"优惠券兑换成功，<a class='u-dialog-link' href='"+environment.globalPath+a+"' >"+e+"</a>",type:"success",callback:function(){window.location.href=environment.globalPath+"/coupon/reputation"}})}else{var n=$("#j-cash-button");2==t.result.couponType&&(n=$("#j-profit-button")),n.removeClass("z-disabled").removeProp("disabled"),_cube.Dialog.show({content:"领用失败！",type:"error"})}}})}require("common/member"),require("module/jquery.extend");var _util=require("common/util"),_cube=require("module/cube"),_template=require("module/template"),$blockAmount=$("#j-blocking-amount");if($blockAmount.length){var $blockTips=$blockAmount.next("em"),blockingTimer=null;$blockAmount.on("mouseenter",function(){$blockTips.show()}).on("mouseleave",function(){blockingTimer=setTimeout(function(){$blockTips.hide()},300)}),$blockTips.on("mouseenter",function(){blockingTimer&&clearTimeout(blockingTimer)}).on("mouseleave",function(t){var e=t.pageX+30,a=$(this).offset().top+30;e>a&&blockingTimer&&$blockTips.hide()})}$("#j-transaction-tab").length&&(renderProfitCal("#j-transaction-tab",36),loadTransactionInterestData()),$("#j-cal-detail").on("click",".j-jump-investment",function(){var t=$(this).data("day"),e=$(this).data("url");window.open(e+"?searchDate="+t,"_blank")});var evaluated=$("#j-evaluated").val(),hasSkipEvaluation=_util.Util.storage("skipEvaluation"),skipEvaluation=function(){_util.Util.storage("skipEvaluation",!0)},showEvaluateTips=function(){+evaluated||hasSkipEvaluation||_cube.Dialog.show({content:"测测你的投资风险承受能力吧",okValue:"去测评",cancelValue:"跳过",callback:function(){location.href="/member/questionnaire"},cancel:skipEvaluation,close:skipEvaluation})};_cube.Checkin.guide("body");var checkinTag="",$checkinGuide=$("#j-checkin-guide");$checkinGuide.length?($checkinGuide.on("click","span,button",function(){checkinTag=$(this)[0].tagName,"SPAN"===checkinTag&&showEvaluateTips()}),$("body").on("click",".u-shade",function(){"BUTTON"===checkinTag&&showEvaluateTips()})):showEvaluateTips();var $checkBtn=$("#j-valueCount-check"),userId=$checkBtn.data("userid")+"",userIdLatter=userId.substr(7,11),checkCount=+_util.Util.storage("checkCount_"+userIdLatter),currentDate=_util.Util.format(+environment.serverDate,"yyyy-MM"),checkDate="";$checkBtn.length&&(checkCount?(checkDate=_util.Util.format(checkCount,"yyyy-MM"),checkDate!==currentDate&&$checkBtn.show()):$checkBtn.show(),$checkBtn.on("click","a",function(){_util.Util.storage("checkCount_"+userIdLatter,Date.now()),$(this).parent().remove()}));
//# sourceMappingURL=memberIndex.js.map
