"use strict";function getVerification(e,t){var r=2;"undefined"!=typeof $("#j-reg-mobile").val()&&(r=1),$.xPost({url:CONFIG.url.telUrl,data:{type:e,mobile:t,isCheckMobile:r,xToken:xToken},callback:function(t){var r=Number(t.result);if($(".j-voice-yes, .j-voice-no").removeAttr("disabled"),t.success)if(r<6){if(timerTips(e),r>2){var i=$(".m-input-vercode").find(".m-val-tips");0===i.length?$(".m-input-vercode").append("<span class='m-val-tips u-hotline-tips'>短信、语音均无法收到？请拨打4000256688</span>"):i.addClass("u-hotline-tips").html("短信、语音均无法收到？请拨打4000256688")}}else limitCodeRequest();else"undefined"!=typeof r&&r>=6?limitCodeRequest():$.xDialog({content:"网络异常，请刷新页面。"})}})}function limitCodeRequest(){$("#j-input-vercode").html("<div class='u-tips-waring f-round f-w430'>"+CONFIG.tips.requestLimitError+"</div>")}function timerTips(e){var t=$(".u-tips-vercode"),r="",i="";"1"===e?(r="短信已发送",i="f-tips-green"):"2"===e&&(r="已呼叫你手机",i="f-tips-blue"),$(".u-tips-voice").length>0?$(".u-tips-voice").remove():$("#j-vercode, #j-img-vercode").remove(),t.remove(),$("#j-phonecode").val("").parent().removeClass("z-hide").before('<span class="f-round u-tips-vercode '+i+'">'+r+' <i id="j-time-count">'+CONFIG.moblieTime+"</i>秒后可重获</span>"),$("#j-phonecode").siblings("em").removeClass("z-hide");var a=setInterval(function(){var e=Number($("#j-time-count").text());0!==e?(e-=1,$("#j-time-count").text(e)):(clearInterval(a),$(".u-tips-vercode").text("重新获取手机验证码").addClass("f-tips-red j-choose-voice f-cur-point u-btn-recode").removeClass("f-tips-blue f-tips-green"))},1e3)}function chooseVoice(){var e=$("#j-phonecode").parent().addClass("z-hide").clone(),t='<div class="m-voice-box"><div class="u-tips-voice u-tips-voice2 f-round f-fs12 f-fl">长时间没收到短信？<br>可使用手机语音验证码，请注意接听来电</div><span class="f-round u-tips-vercode f-tips-blue f-cur-point j-voice-yes">使用语音验证</span><br/><span class= "f-round u-tips-vercode f-tips-green f-cur-point j-voice-no">获取短信验证 </span></div>';$(".m-input-vercode").html(t),$(".m-voice-box").after(e)}function validMobile(){var e=$("#j-cpn").data("isCorrect"),t=$("#j-cpn").data("isCancel"),r=$("#j-pngcode"),i=$("#j-phonecode");if("undefined"==typeof e||e===!1){var a="请输入正确的手机号码";return"undefined"!=typeof t&&t&&(a="该账号异常，请联系客服"),$("#j-cpn").next(".m-val-tips").validTips("error",a),!1}if(""===r.val())return $("#j-vercode").parent().siblings(".m-val-tips").validTips("error","请输入图形验证码"),!1;var s=i.data("isCorrect"),o=i.next(".m-val-tips");return""!==i.val()&&"undefined"!=typeof s&&s!==!1||(o.length>0?o.validTips("error","请输入正确的手机验证码"):i.after('<span class="m-val-tips"><i class="u-icon u-icon-error f-icon-s">&nbsp;</i>请输入正确的手机验证码</span>'),!1)}require("module/jquery.extend");var CONFIG={url:{telUrl2:environment.globalPath+"/security/checkMember?type=1",imgUrl:environment.globalPath+"/security/checkCode",telUrl:environment.globalPath+"/security/sendMobileCode",checkUrl:environment.globalPath+"/security/checkMobileCode"},mobileCount:6,moblieTime:60,tips:{imgCodeError:"请输入正确的图形验证码",requestLimitError:"抱歉，您今天的验证码发送次数已超过限制！请明日再试。",cpnNotCorrect:"请输入正确的手机号码",cpnExistedError:"手机号码已被注册",cpnNotExistedError:"手机号码未注册",argeeError:"请先阅读并同意《有融网服务协议》。",checkCodeError:"请输入正确的手机验证码"}},xToken=$("#xToken").val();$("#j-register-argreement-link").xArgreement(),$("#j-register-banner").fadeShow({time:5e3,type:"adv"});var $cpn=$("#j-cpn");$cpn.on("keypress",function(e){$(this).data("prevValue",$(this).val())}).on("keyup",function(e){var t=$(this).val(),r=$(this).data("prevValue");return t.indexOf(" ")!==-1?(t=t.replace(" ",""),$(this).val(t),!1):void(t!==r&&$(this).checkMobile({handler:1,refer:0,event:e.type}))}).on("blur",function(){var e="请输入正确的手机号码",t=$(this).val().length;t<11&&(0===t&&(e="请输入手机号码"),$(this).data("isCorrect",!1).next(".m-val-tips").validTips("error",e))});var $refercode=$("#j-refercode");$refercode.on("keyup postpaste",function(e){var t=$(this);""===t.val()?t.next(".m-val-tips").empty():t.checkMobile({handler:1,refer:1,event:e.type})}).on("blur",function(){""!==$(this).val()&&$(this).val().length<11&&$(this).next(".m-val-tips").validTips("error","请输入正确的手机号码")}),$refercode.on("postpaste",function(){}).pasteEvents();var $vercode=$("#j-vercode");$vercode.on("focus",function(){var e=$("#j-cpn"),t=e.data("isCorrect");0!==e.val().length&&t||(e.focus(),e.data({isCorrect:!1}))});var $inputVercode=$("#j-input-vercode"),$regForm=$("#j-reg-form");$vercode.on("keyup",function(){var e=$(this),t=$(this).val();if(4===t.length){var r=$("#j-cpn").val();$(this).parent().find(".m-val-tips").empty(),11===r.length&&$("#j-cpn").data("isCorrect")===!0&&$.xPost({url:CONFIG.url.imgUrl,data:{code:t,mobile:r,xToken:xToken},callback:function(i){var a=Number(i.resultCodeEum[0].code),s=Number(i.result);if(1===a)switch(e.parents(".m-input-vercode").find(".m-val-tips").html(""),$("#j-pngcode").val(t),s){case 0:getVerification("1",r),$("#j-cpn").addClass("z-disabled").attr("readonly","readonly");break;case CONFIG.mobileCount:limitCodeRequest();break;default:chooseVoice()}else e.parents(".m-input-vercode").find(".m-val-tips").validTips("error",CONFIG.tips.imgCodeError)}})}else t.length>4&&$(this).val(t.substr(0,4))}),$inputVercode.on("click",".j-choose-voice",{},function(){chooseVoice(),$(".j-phonecode").empty()}),$inputVercode.on("click",".u-tips-vercode",{},function(){var e=(Number($("#j-cpn").val()),"1");if($(this).hasClass("j-voice-yes"))e="2",$("#j-cpn").checkMobile({handler:2,type:e,event:"click"});else{if(!$(this).hasClass("j-voice-no"))return!1;e="1",$("#j-cpn").checkMobile({handler:2,type:e,event:"click"})}$("#j-phonecode").data("checkType",e),$("#j-checkType").val(e)}),$regForm.on("keyup","#j-vercode2",function(){var e=$(this),t=$(this).val(),r=$("#j-cpn").val();4===t.length?$.xPost({url:CONFIG.url.imgUrl,data:{code:t,mobile:r,xToken:xToken},callback:function(r){var i=Number(r.resultCodeEum[0].code);1===i?(e.parent().siblings(".m-val-tips").validTips("success"),$("#j-pngcode").val(t)):(e.parent().siblings(".m-val-tips").validTips("error",CONFIG.tips.imgCodeError),$("#j-pngcode").val(t))}}):t.length>4&&$(this).val(t.substr(0,4))}),$inputVercode.on("click",".u-img-vercode",function(){var e=(new Date).getTime();$(this).attr("src",environment.globalPath+"/security/validateCode?t="+e),$("#j-vercode2").empty()}),$regForm.on("keyup","#j-phonecode",{},function(){var e=$(this).val(),t=$("#j-cpn").val(),r=$(this),i="1",a=$(this).parent().find(".m-val-tips");0===a.length&&$(this).parent().append('<span class="m-val-tips">&nbsp;</span>');var s=$(this).data("checkType");"undefined"!=typeof s&&(i=s),4===e.length?isNaN(Number(e))?a.validTips("error","验证码为数字"):$.xPost({url:CONFIG.url.checkUrl,data:{type:i,code:e,mobile:t,xToken:xToken},callback:function(e){var t=Number(e.resultCodeEum[0].code);1===t?(a.validTips("success"),$("#j-mobile").show(),r.data("isCorrect",!0)):(a.validTips("error",CONFIG.tips.checkCodeError),r.data("isCorrect",!1))}}):e.length>4&&$(this).val(e.substr(0,4))}),$regForm.submit(function(){var e=$(this),t=e.data("action"),r=e.serializeArray(),i=e.data("page"),a=!0;if("undefined"!=typeof i){switch(i){case"login":if(!formValid.check(!1))return!1;$("#j-login-submit").val("登录中").addClass("z-disabled").attr("disabled",!0);break;case"register":var s=validMobile();if(!s)return!1;if(!formValid.check(!1))return!1;$(".j-reg-btn").val("注册中").addClass("z-disabled").attr("disabled",!0);break;case"lostPwd":var o=validMobile();return!!o&&(!!formValid.check(!1)&&(a=!1,!0));case"updatePwd":if(!formValid.check(!1))return!1;$(".j-updatepwd-btn").val("修改中").addClass("z-disabled").attr("disabled",!0);break;case"changePwd":if(!formValid.check(!1))return!1;$(".j-changepwd-btn").val("修改中").addClass("z-disabled").attr("disabled",!0)}return a&&$.xPost({url:t,data:r,callback:function(t){if(t.success){var r=environment.globalPath;switch(i){case"login":$("#j-reg-error").empty().hide(),$("#j-login-submit").val("登录").removeClass("z-disabled").removeAttr("disabled"),t.result.indexOf("http")>=0?window.location.href=t.result:window.location.href=r+t.result;break;case"register":$(".j-reg-btn").val("注册").removeClass("z-disabled").removeAttr("disabled"),window.location.href=r+"/member/sinapay?register=true";break;case"updatePwd":$(".j-updatepwd-btn").val("修改密码").removeClass("z-disabled").removeAttr("disabled");var a=$("#j-repwd-tips");e.remove(),a.show();var s=setInterval(function(){var e=Number($("#j-time-count").text());0!==e?(e-=1,$("#j-time-count").text(e)):(clearInterval(s),window.location.href=r+"/security/login/")},1e3);break;case"changePwd":$(".j-changepwd-btn").val("修改密码").removeClass("z-disabled").removeAttr("disabled");var o=$("#j-repwd-tips");e.remove(),o.show();var n=setInterval(function(){var e=Number($("#j-time-count").text());0!==e?(e-=1,$("#j-time-count").text(e)):(clearInterval(n),window.location.href=r+"/security/login/")},1e3);break;default:return!1}}else switch(i){case"login":$("#j-login-submit").val("登录").removeClass("z-disabled").removeAttr("disabled");var l=Number(t.resultCodeEum[0].code),c="";switch(90019===l?$("#j-login-error").fadeToggle().html("您输入的图形验证码有误").fadeIn():$("#j-login-error").fadeToggle().html("您输入的帐号或密码有误").fadeIn(),l){case 90019:c="您输入的图形验证码有误";break;case 90003:c="您的账号已注销，如需帮助，请联系客服";break;default:c="您输入的帐号或密码有误"}$("#j-login-error").fadeToggle().html(c).fadeIn();var d=($("#j-img-vercode2"),environment.globalPath+"/security/validateCode");t.result>3&&($("#j-img-vercode2").attr("src",d),$("#j-login-submit").before($(".m-input-vercode")),$(".m-input-vercode").show().find("input").show());break;case"register":$(".j-reg-btn").val("注册").removeClass("z-disabled").removeAttr("disabled");var v=Number(t.resultCodeEum[0].code);switch(v){case 90009:$.xDialog({content:"请输入正确的手机验证码。",type:"error"});break;case 10001:$.xDialog({content:"网络异常，请重新提交。",type:"warn"});break;case 4:$.xDialog({content:"网络异常，请刷新页面。",type:"warn"});break;default:$.xDialog({content:"网络异常，请刷新页面。",type:"warn"})}break;case"updatePwd":$(".j-updatepwd-btn").val("修改密码").removeClass("z-disabled").removeAttr("disabled"),null!==t.resultCodeEum[0]&&$.xDialog({content:t.resultCodeEum[0].msg,type:"error"});break;case"changePwd":$(".j-changepwd-btn").val("修改密码").removeClass("z-disabled").removeAttr("disabled"),null!==t.resultCodeEum[0]&&$.xDialog({content:t.resultCodeEum[0].msg,type:"error"});break;default:return!1}}}),!1}}),$("#j-agree").change(function(){var e=$(this).is(":checked"),t=$("input[type=submit]");e?t.removeClass("z-disabled").removeAttr("disabled"):t.addClass("z-disabled").attr("disabled","disabled")}),$("#j-phonecode, #j-vercode").on("keyup",function(){var e=$(this).siblings("em");"undefined"!=typeof e&&$(this).val().length>0?e.addClass("z-hide"):e.removeClass("z-hide")}).on("blur",function(){var e=$(this).siblings("em");"undefined"!=typeof e&&""===$(this).val()&&e.removeClass("z-hide")}),$(".u-xtips-wrap").on("click","em",function(){$(this).siblings("input").focus()}),window.mozPaintCount&&($("#j-pngcode").val(""),$cpn.val("")),$.fn.validTips=function(e,t){var r="error";"success"===e&&(r="success",t="");var i="<span class='m-val-tips'><i class='u-icon u-icon-"+r+" f-icon-s'>&nbsp;</i>"+t+"&nbsp;</span>";$(this).replaceWith(i)},$.fn.checkMobile=function(e){var t=$(this),r=t.val(),i=!1,a="",s="",o=/^13[0-9]{9}$|14[5,7]{1}[0-9]{8}$|15[0-9]{9}$|17[0,1,3,6,7,8]{1}[0-9]{8}$|18[0-9]{9}$/;if("undefined"==typeof e)throw new Error("config is not defined");var n="undefined"!=typeof e.handler?e.handler:1,l="undefined"!=typeof e.type?e.type:0,c="undefined"!=typeof e.refer?e.refer:0;if(s="undefined"!=typeof e.cpn?e.cpn:"","undefined"!=typeof $("#j-reg-mobile").val()&&1!==e.refer||(i=!0,a="1"),11===r.length){t.next(".m-val-tips");if(isNaN(r))return t.next(".m-val-tips").validTips("error",CONFIG.tips.cpnNotCorrect),t.data({isCorrect:!1}),!1;o.test(r)?$.xPost({url:CONFIG.url.telUrl2,data:{code:r,type:1,mobile:s,getTrueName:a,xToken:xToken},callback:function(e){var a=Number(e.resultCodeEum[0].code),s=$("#j-reg-form").data("page");if(0!==a)switch(a){case 90002:if(i){var o=CONFIG.tips.cpnNotExistedError;"lostPwd"!==s&&(o="推荐人不存在",$("#j-refercode-val").val("")),t.next(".m-val-tips").validTips("error",o),t.data({isCorrect:!1})}else t.next(".m-val-tips").validTips("success"),t.data({isCorrect:!0}),2===n&&getVerification(l,r);break;case 90003:i&&"lostPwd"!==s?(t.next(".m-val-tips").text("您的推荐人已注销"),$("#j-refercode-val").val("")):t.next(".m-val-tips").validTips("error","该账号异常，请联系客服"),t.data({isCorrect:!1,isCancel:!0});break;case 90018:if(i){if(t.data({isCorrect:!0}),1!==c)t.next(".m-val-tips").validTips("success");else{var d=e.result[0],v=e.result[1];null!==d&&d.length>1?t.next(".m-val-tips").text("您的推荐人:"+d):t.next(".m-val-tips").validTips("success",""),$("#j-refercode-val").val(v)}2===n&&getVerification(l,r)}else t.next(".m-val-tips").validTips("error",CONFIG.tips.cpnExistedError),t.data({isCorrect:!1});break;default:return!1}}}):(t.next(".m-val-tips").validTips("error",CONFIG.tips.cpnNotCorrect),t.data({isCorrect:!1}))}else r.length>11?$(this).val(r.substr(0,11)):Number(r)||$(this).val(r.replace(/[^\d]/g,""))};
//# sourceMappingURL=register.js.map
