"use strict";function goLoginPage(){_util.Util.post({url:urls.receive})}require("module/jquery.extend");var _template=require("module/template"),_util=require("common/util"),_cube=require("module/cube"),domain=env.globalPath,urls={init:environment.globalPath+"/activity/marathon/init",receive:environment.globalPath+"/activity/marathon/receive",list:environment.globalPath+"/activity/marathon/list"},logined=$("#j-main").data("logined");_util.Util.post({url:urls.init,callback:function(t){t.success?init(t.result):log("后台加载数据异常：",t)}});var init=function(t){var e=t.activityStatus||"",a=(t.startTime||"",t.totalKm||0,t.packages||0,t.boxes||0,t.topList||[]),o=t.avatar||"";if(logined){t.avatar&&$("#j-this-avatar").attr("src","http://oss.aliyuncs.com"+o).addClass("z-square"),$("#j-mapIcon").removeClass("z-hide"),$("#j-totalPop").text(t.totalPop||0),$("#j-totalCoupon").text(t.totalCoupon||0),$("#j-result-content").removeClass("z-hide");var i=$("html, body"),s=$("#j-assist").offset().top-80;$("#j-checkAssist").on("click",function(){i.animate({scrollTop:s},500)}),$("#j-btn-invite").on("click",function(){$("#j-qrcode-wrap").removeClass("z-hide"),$.shade("show")});var n=new Clipboard("#j-copy-invite");n.on("success",function(){_cube.Dialog.show({type:"success",content:"复制成功"})}),$("body").on("click",".u-shade, #j-qrcode-close",function(){$("#j-qrcode-wrap").addClass("z-hide"),$.shade("hide")})}else $("#j-btn-packages, #j-btn-boxes, #j-checkAssist, #j-btn-invite").on("click",function(){goLoginPage()});switch(e){case 2:beforeActive(t);break;case 4:duringActive(t);break;case 6:afterActive(t)}if(0==a.length)$("#j-gainList").addClass("z-noData").text("快来和好友一起参加活动吧");else{var c=(0,_template.template)("j-gainList-tpl",t);$("#j-gainList").html(c).scrollList({size:5,height:50,length:1,time:5e3,stoppable:!0})}},beforeActive=function(t){$("#j-gainList").addClass("z-noData").html("暂无数据");var e=$("#j-assist-table-wrap").height();$("#j-assist-shade").text("快来和好友一起参加活动吧").css("height",e).removeClass("z-hide"),logined&&$("#j-btn-packages, #j-btn-boxes").on("click",function(){_cube.Dialog.show({content:"活动未开始"})})},duringActive=function(t){function e(t){var e=t.totalKm||0,a={totalKm1:{coupon30:1,coupon50:1,coupon100:1},totalKm2:{coupon30:2,coupon50:1,coupon100:1},totalKm3:{coupon30:2,coupon50:2,coupon100:1},totalKm4:{coupon30:1,coupon50:1,coupon100:2},totalKm5:{coupon30:2,coupon50:1,coupon100:2},totalKm6:{coupon30:3,coupon50:1,coupon100:2},totalKm7:{coupon30:2,coupon50:2,coupon100:2}},o=Math.ceil(e/100);log(o),o>6&&(o=7),0==o&&(o=1);var i=(0,_template.template)("j-box-detail-tpl",a["totalKm"+o]);$("#j-box-detail").html(i)}t.totalKm-0||0,t.friendListCount||0;if(logined&&($("#j-packages").text(t.packages||0),$("#j-boxes").text(t.boxes||0)),setMapSituation(t.totalKm||0),e(t),logined?t.packages>0&&$("#j-packages").text()-0>0?($("#j-packages").text(t.packages).parent().removeClass("z-hide"),$("#j-btn-packages").on("click",function(){$(this);$("#j-packages").text()-0==0?_cube.Dialog.show({content:"没有奖励可领取哦"}):_util.Util.post({url:urls.receive,data:{rewardType:1},callback:function(t){if(t.success){_cube.Dialog.show({type:"success",content:"恭喜你获得幸运背包一个<br>奖励"+t.result.receiveReturnStr});var e=$("#j-packages").text()-0;e>0&&$("#j-packages").text(e-1)}else _cube.Dialog.show({content:"没有奖励可领取哦"})}})})):$("#j-btn-packages").on("click",function(){_cube.Dialog.show({content:"没有奖励可领取哦"})}):$("#j-btn-packages").on("click",function(){goLoginPage()}),logined?t.boxes>0&&$("#j-boxes").text()-0>0?($("#j-boxes").text(t.boxes).parent().removeClass("z-hide"),$("#j-btn-boxes").on("click",function(){$(this);$("#j-boxes").text()-0==0?_cube.Dialog.show({content:"没有奖励可领取哦"}):_util.Util.post({url:urls.receive,data:{rewardType:2},callback:function(t){if(t.success){for(var e=t.result.receiveReturnStr,a=e.split(","),o="",i=0;i<a.length;i++){var s=a[i].split("-");console.log(s),o+="奖励"+s[0]+"元现金券"+s[1]+"张 <br>"}o='<span style="position:relative; top: -40px">恭喜你获得幸运宝箱一个<br>'+o+"</span>",_cube.Dialog.show({type:"success",content:o});var n=$("#j-boxes").text()-0;n>0&&$("#j-boxes").removeClass("z-hide").text(n-1)}else _cube.Dialog.show({content:"没有奖励可领取哦"})}})})):$("#j-btn-boxes").on("click",function(){_cube.Dialog.show({content:"没有奖励可领取哦"})}):$("#j-btn-boxes").on("click",function(){goLoginPage()}),logined){var a=function(t){var e=t.result,a=e.friendListCount;if(a>5){for(var i=function(t){_util.Util.post({url:urls.list,data:{startNo:t},callback:function(t){t.success&&t.result.friendList&&t.result.friendList.length>0&&o(t)}})},s=Math.ceil(a/5),n="",c=0;c<s;c++){var l=c+1;n+=0==c?'<li class="u-page z-current" data-startNo="'+5*c+'">'+l+"</li>":'<li class="u-page" data-startNo="'+5*c+'">'+l+"</li>"}n='<li class="u-prev" id="j-prev">上一页</li>'+n+'<li class="u-next" id="j-next">下一页</li>',$("#j-pagination").html(n).removeClass("z-hide");var r=$("#j-pagination");r.on("click",".u-page",function(){var t=$(this),e=t.attr("data-startNo");t.hasClass("z-current")||(t.addClass("z-current").siblings(".u-page").removeClass("z-current"),i(e))}).on("click","#j-prev",function(){var t=r.find(".z-current").index()+1;if(2==t)return!1;r.find("li.z-current").removeClass("z-current").prev("li").addClass("z-current");var e=r.find(".z-current").attr("data-startNo");i(e)}).on("click","#j-next",function(){if(r.find(".z-current").index()==r.find("li").length-2)return!1;r.find("li.z-current").removeClass("z-current").next("li").addClass("z-current");var t=r.find(".z-current").attr("data-startNo");i(t)})}};_util.Util.post({url:urls.list,callback:function(t){if(t.success)o(t),a(t);else{var e=$("#j-assist-table-wrap").height();$("#j-assist-shade").css("height",e).removeClass("z-hide")}}});var o=function(t){var e=t.result||{},a=e.friendList||[];if(a.length>0){var o=[],i={};$.each(a,function(t,e){o=[],i={};var a=e.remark||"";o=a.split(","),$.each(o,function(t,e){e&&(i[e]=e)}),e.friendListObj=i});var s=(0,_template.template)("j-friendList-tpl",t.result);$("#j-friendList").html(s)}else{var n=$("#j-assist-table-wrap").height();$("#j-assist-shade").css("height",n).removeClass("z-hide")}}}},afterActive=function(t){alert("活动已结束")},setMapSituation=function(t){var e,a,o,i=$("#j-mapIcon"),s=$("#j-mapIcon-content-wrapper"),n=$("#j-mapIcon-content"),c=$(".j-roadSign"),l=0;e=t-10*Math.floor(t/10)-0,a=(t-100*Math.floor(t/100)-e)/10,o=(t-1e3*Math.floor(t/1e3)-10*a-e)/100-0,t>100&&(l=t-10*a-e,t%100===0&&(a=10),t==l?c.each(function(){$(this).text($(this).attr("data-roadNotice")-0+l-100)}):c.each(function(){$(this).text($(this).attr("data-roadNotice")-0+l)})),100==t&&(a=10),t>9999&&(s.addClass("z-bigger"),c.addClass("z-smallFont")),i.removeClass().addClass("u-mapIcon").addClass("z-step"+a),n.text(t)};$(".j-vr-bag").hover(function(t){t.stopPropagation(),$(this).find(".u-gift-detail").toggleClass("z-fadeIn")});var $shareDiv=$("#j-share>div");$(".j-popup-trigger").hover(function(){$shareDiv.removeClass("z-fadeIn"),$(this).next().addClass("z-fadeIn")},function(){$shareDiv.removeClass("z-fadeIn")});
//# sourceMappingURL=marathon.js.map
