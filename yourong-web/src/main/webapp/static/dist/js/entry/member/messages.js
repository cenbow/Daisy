"use strict";function renderNotifySettingItem(){var item=memberNotifySettingsConfig.notifySettingItem;if(""!=item)for(var data=eval("("+item+")"),i=0;i<data.length;i++){var notifyType=data[i][0],notifyWay=data[i][1],id="notify_"+notifyType+"_"+notifyWay;$("#"+id).length&&($("#"+id).addClass("z-checked"),document.getElementById(id+"_box").checked=!0)}}function saveNotifySetting(){var e=$("#memberNotifySettingsForm").serializeArray(),t={url:environment.globalPath+"/member/updateMemberNotifySettings",data:e,callback:saveNotifySettingCallback};$.xPost(t)}function saveNotifySettingCallback(e){""!=e&&(e.success?($("#j-feed-change").html("保存").removeClass("z-disabled"),$.xDialog({type:"success",content:"订阅配置保存成功"})):$.xDialog({type:"error",content:"订阅配置保存失败"}))}require("common/member"),require("module/jquery.extend");var _util=require("common/util");$("#j-feed-change[type!='submit']").on("click",function(){$(this).hasClass("z-disabled")||($(this).addClass("z-disabled"),$(this).html("请稍候..."),saveNotifySetting())});var filterCheckObj=$("#j-filter-check"),umsgListObj=$("#j-umsg-list"),msgUrl=environment.globalPath+"/message/queryMessage";if(filterCheckObj.length){var getMessagesList=function(e,t,s){var i=s?s:getFilterValues();$(".m-umsg-list").xLoading(function(s){$.getJSON(e,i,function(e){e.data.length?(renderMessages(e,t),umsgListObj.data("pageNo",t)):renderNullMessage(),s.find(".u-xloading").remove()})},"fixed")},renderMessages=function(e,t){var s='<i class="u-umsg-icon u-msgWrap-tl"></i><i class="u-umsg-icon u-msgWrap-tr"></i><i class="u-umsg-icon u-msgWrap-bl"></i><i class="u-umsg-icon u-msgWrap-br"></i>',i=[],a=e.data,n=$("#j-umsg-list"),l=n.find(".u-msglist-more"),r=a.length;l.prev().removeClass("z-last"),$.each(a,function(e,t){var a=_util.Util.format(t.time,"yyyy-MM-dd"),n=_util.Util.format(t.time,"hh:mm:ss"),l="";t.hasRead||(l=" z-unread"),e+1===r&&(l+=" z-last"),i.push('<li class="f-cf'+l+'" data-id="'+t.msgId+'"><div class="u-msglist-date f-fl">'+a+"<span>"+n+'</span><i>●</i></div><div class="u-msglist-content f-fl"><div>'+t.content+"</div>"+s+"</div></li>")}),10===r&&t!==e.maxPager?(l.length&&l.remove(),i.push('<li class="f-cf u-msglist-more" id="j-msglist-more"><div class="u-msglist-date f-fl"></div><div class="u-msglist-content f-fl"><div><a href="javascript:void(0)">查看更多</a></div>'+s+"</div></li>")):l.remove(),1===t?n.html(i.join("")):n.append(i.join(""))},renderNullMessage=function(){$("#j-umsg-list").empty().html('<li class="u-umsg-empty f-dn">暂无消息</li>'),$(".u-umsg-empty").fadeIn(750)},getFilterValues=function(){return $("#j-umsg-filter").serialize()};getMessagesList(msgUrl,1),filterCheckObj.on("click","input",function(){return!!filterCheckObj.find("input:checked").length&&($(this).parents("label").toggleClass("z-checked"),void getMessagesList(msgUrl,1))}),$("#j-umsg-dataSelect").on("click","li",function(){$(this).hasClass("z-first")||$(this).addClass("z-hidden").siblings().removeClass("z-hidden"),getMessagesList(msgUrl,1)}),$("#j-umsg-markRead").on("click",function(){return!!umsgListObj.find("li.f-cf").length&&void $.getJSON(environment.globalPath+"/message/batchUpdateMessageStatus",getFilterValues(),function(e){e.success&&($(".m-umsg-list").find("li").removeClass("z-unread"),$("#j-umsg-notice").addClass("z-hidden"))})}),umsgListObj.on("click",".u-msglist-content",function(){var e=$(this),t=$(this).parent(),s=t.data("id"),i={msgId:s};t.hasClass("z-unread")&&$.getJSON(environment.globalPath+"/message/updateMessageStatus",i,function(t){if(t.success){e.parent().removeClass("z-unread");var s=$("#j-umsg-number");"1"!==s.text()?s.text(s.text()-1):s.parent().addClass("z-hidden")}})}),umsgListObj.on("click",".u-msglist-more",function(){var e=$(this).prevAll().length;if(e%10>0)return!1;var t=$(this).parent(),s=t.data("pageNo");"undefined"!=typeof s?s+=1:s=2;var i=getFilterValues()+"&pageNo="+s;getMessagesList(msgUrl,s,i)})}$(".notify-ckbox").on("click",function(){if(!$(this).attr("disabled")){var e;$(this).hasClass("z-checked")?($(this).removeClass("z-checked"),e=$(this).children("input").attr("id"),document.getElementById(e).checked=!1):($(this).addClass("z-checked"),e=$(this).children("input").attr("id"),document.getElementById(e).checked=!0)}});
//# sourceMappingURL=messages.js.map
